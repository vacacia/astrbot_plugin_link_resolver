# Changelog

## v1.0.8

### 修复

- 修复 v1.0.6 修改 UA 导致抖音解析失败的问题

## v1.0.7

### 新增

- 新增 `error_notify_mode` 配置项，控制解析/下载失败时 Bot 对用户的反馈行为：
  - **静默**（默认）：仅记录日志，不向群内发送任何错误消息
  - **脱敏**：发送通用错误提示（如"视频下载失败"），不包含异常详情
  - **报错**：发送完整错误信息，包含异常详情（旧版默认行为）

### 修复

- 修复 B 站视频下载/发送失败时将 `str(exc)` 直接发送给用户，可能泄露内部信息（文件路径、网络错误详情、API 响应等）的问题

## v1.0.6

### 新增

- 新增 `merge_send_as_sender` 配置项，合并转发的发送人可显示为发送链接的用户

### 优化

- ~~引入 `CHROME_UA` 常量，统一各平台 User-Agent~~（已在 v1.0.8 回退）
- 解析任务管理从全局变量迁移为实例级任务池，插件重载时自动清理旧任务
- 统一使用 `time.perf_counter()` 记录耗时
- 优化小红书图片下载逻辑
- 优化日志记录格式

### 移除

- 移除 API 超时时间配置项（无实际作用）
- 移除自动清理延迟配置项（无实际作用）

## v1.0.5

### 修复

- 修复 B 站并发发送时 ENOENT 竞态：下载文件增加 `request_id` 后缀避免同名冲突，发送前增加文件存在性校验

## v1.0.4

### 新增

- 新增 `bili_max_duration_seconds` 配置项，支持 B 站视频最大时长限制
- 增强小红书重试机制与错误处理

## v1.0.3

### 修复

- 修复短链接解析异常处理并优化图片下载逻辑

## v1.0.2

### 优化

- 重构路径管理，改善 Cookie 处理逻辑

## v1.0.1

### 新增

- 初始版本：支持 B 站 / 抖音 / 小红书链接自动解析
- 插件配置页面支持粘贴 B 站 cookies.txt
